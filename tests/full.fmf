require:
- python3-pytest
- python3-flexmock
- python3-pytest-asyncio
- python3-aioresponses
- podman

component:
- logdetective

environment:
  POSTGRESQL_USER: user
  POSTGRESQL_PASSWORD: password
  POSTGRESQL_DATABASE: test_db
  POSTGRESQL_ADMIN_PASSWORD: adminpassword

setup:
  - name: Start PostgreSQL container
    how: shell
    script: |
      podman run -d --name postgresql-test \
        -e POSTGRESQL_USER=$POSTGRESQL_USER \
        -e POSTGRESQL_PASSWORD=$POSTGRESQL_PASSWORD \
        -e POSTGRESQL_DATABASE=$POSTGRESQL_DATABASE \
        -e POSTGRESQL_ADMIN_PASSWORD=$POSTGRESQL_ADMIN_PASSWORD \
        -p 5432:5432 \
        quay.io/sclorg/postgresql-15-c9s

      sleep 3 # wait for db to be up and running

test: pytest-3 -vv .

duration: 30m

teardown:
  - name: Stop and remove PostgreSQL container
    how: shell
    script: |
      podman stop postgresql-test || true
      podman rm postgresql-test || true
